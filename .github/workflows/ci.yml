# Fichier: .github/workflows/ci.yml
name: CI Java Maven

on:
  # Déclenche le workflow à chaque push sur la branche main
  push:
    branches: [ main ]
  # Déclenche aussi à chaque pull request pour vérifier le code avant l'intégration
  pull_request:
    branches: [ main ]

jobs:
  build:
    # Exécute le job sur une machine virtuelle Ubuntu
    runs-on: ubuntu-latest

    steps:
    # Étape 1: Récupérer le code du dépôt
    - name: Checkout du code
      uses: actions/checkout@v4

    # Étape 2: Configurer Java 17
    - name: Configurer JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven

    # Étape 3: Construction et Exécution des Tests
    - name: Construction et Tests avec Maven
      run: mvn -B clean install --file pom.xml
      # Étape 4: Télécharger l'artefact (le JAR)
    - name: Télécharger l'artefact (JAR)
      uses: actions/upload-artifact@v4
      with:
        # Nom de l'artefact tel qu'il apparaîtra sur GitHub
        name: application-jar
        # Chemin vers le fichier JAR généré par Maven
        path: target/demo-ci-1.0.jar
        deploy:
    # Ce job ne s'exécute que si le job 'build' a réussi
    needs: build
    # Utiliser un environnement de déploiement (pour cette démo, on utilise Ubuntu)
    runs-on: ubuntu-latest

    steps:
    # Étape 1: Télécharger l'artefact créé par le job 'build'
    - name: Télécharger l'artefact JAR
      uses: actions/download-artifact@v4
      with:
        name: application-jar
        # Le JAR sera téléchargé dans le répertoire courant

    # Étape 2: Simuler l'étape de Déploiement
    - name: Déploiement de l'application
      run: |
        echo "--- Démarrage du Déploiement Continu ---"
        # Afficher le fichier pour confirmer qu'il a été téléchargé
        ls -la
        echo "L'artefact (demo-ci-1.0.jar) est prêt à être déployé."
        echo "CONNEXION AU SERVEUR DE PRODUCTION (simulation)..."
        echo "DÉPLOIEMENT TERMINÉ."